PUPPET_COMMAND_START
 [WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details

PLAY [puppetmaster] ************************************************************


TASK [puppetmaster : Read hostvars] ********************************************
changed: [161.202.63.231 -> localhost]

TASK [puppetmaster : Create Json Template] *************************************
skipping: [161.202.63.231]


TASK [puppetmaster : Append Json Data] *****************************************
skipping: [161.202.63.231]

TASK [puppetmaster : remove ansible block] *************************************

skipping: [161.202.63.231]

TASK [puppetmaster : get value for iptables] ***********************************
changed: [161.202.63.231 -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]

TASK [puppetmaster : get value for ssh_keys] ***********************************
changed: [161.202.63.231 -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]

TASK [puppetmaster : get value for filebeat] ***********************************

changed: [161.202.63.231 -> localhost]

TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]


TASK [puppetmaster : stat] *****************************************************
ok: [161.202.63.231 -> localhost]

TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]


TASK [puppetmaster : stat] *****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : debug] ****************************************************

skipping: [161.202.63.231]

TASK [puppetmaster : stat] *****************************************************
skipping: [161.202.63.231]


TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : stat] *****************************************************
ok: [161.202.63.231 -> localhost]


TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : set_fact] *************************************************

ok: [161.202.63.231]

TASK [puppetmaster : include_tasks] ********************************************
included: /ansible/puppet/roles/puppetmaster/tasks/puppetcreate.yml for 161.202.63.231


TASK [puppetmaster : Create sub directory] *************************************
ok: [161.202.63.231] => (item=modules)
ok: [161.202.63.231] => (item=manifests)

TASK [puppetmaster : Create IPTABLES Modules Manifests subdirectory] ***********

ok: [161.202.63.231] => (item=manifests)
ok: [161.202.63.231] => (item=templates)

TASK [puppetmaster : Create SSH_KEYS Modules Manifests subdirectory] ***********
skipping: [161.202.63.231] => (item=manifests) 

skipping: [161.202.63.231] => (item=templates) 

TASK [puppetmaster : Create STDLIB Modules Manifests subdirectory] *************
ok: [161.202.63.231]


TASK [puppetmaster : Create Filebeat Modules Manifests subdirectory] ***********
ok: [161.202.63.231] => (item=manifests)
ok: [161.202.63.231] => (item=templates)

TASK [puppetmaster : Provide puppet environment] *******************************

ok: [161.202.63.231]

TASK [puppetmaster : Check defaults manifests node] ****************************
ok: [161.202.63.231]


TASK [puppetmaster : Create defaults manifests] ********************************
skipping: [161.202.63.231]

TASK [puppetmaster : iptables modules] *****************************************
included: /ansible/puppet/roles/puppetmaster/tasks/iptables.yml for 161.202.63.231


TASK [puppetmaster : Get iptables config df] ***********************************
skipping: [161.202.63.231]

TASK [puppetmaster : Get iptables config df] ***********************************

skipping: [161.202.63.231]

TASK [puppetmaster : Get iptables config k365] *********************************
skipping: [161.202.63.231]


TASK [puppetmaster : Get iptables config ebet] *********************************
skipping: [161.202.63.231]

TASK [puppetmaster : Get iptables config qp] ***********************************
skipping: [161.202.63.231]


TASK [puppetmaster : Get iptables config v68-test] *****************************
skipping: [161.202.63.231]

TASK [puppetmaster : Get iptables config] **************************************

ok: [161.202.63.231]

TASK [puppetmaster : Get iptables config cdn] **********************************
skipping: [161.202.63.231]


TASK [puppetmaster : Get additional iptables config] ***************************
ok: [161.202.63.231]

TASK [puppetmaster : Get iptables puppet] **************************************
ok: [161.202.63.231]


TASK [puppetmaster : Get iptables config] **************************************
skipping: [161.202.63.231]

TASK [puppetmaster : find iptables.sh] *****************************************

skipping: [161.202.63.231]

TASK [puppetmaster : set fact] *************************************************
skipping: [161.202.63.231]


TASK [puppetmaster : Get additional iptables config] ***************************
skipping: [161.202.63.231]

TASK [puppetmaster : Create append iptables] ***********************************
skipping: [161.202.63.231]


TASK [puppetmaster : Append iptables] ******************************************
skipping: [161.202.63.231]

TASK [puppetmaster : Get additional iptables config] ***************************

skipping: [161.202.63.231]

TASK [puppetmaster : Get iptables puppet] **************************************
skipping: [161.202.63.231]


TASK [puppetmaster : ssh_keys modules] *****************************************
skipping: [161.202.63.231]

TASK [puppetmaster : filebeat modules] *****************************************
included: /ansible/puppet/roles/puppetmaster/tasks/filebeat.yml for 161.202.63.231


TASK [puppetmaster : Get filebeat config] **************************************
ok: [161.202.63.231]

TASK [puppetmaster : Get filebeat puppet] **************************************

ok: [161.202.63.231]

TASK [puppetmaster : Get rsyslog] **********************************************
ok: [161.202.63.231]


PLAY [ruibo-nginx] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [47.75.36.60]
ok: [119.81.239.182]

ok: [23.99.120.65]
ok: [119.9.116.251]
ok: [13.70.23.40]
ok: [119.9.104.50]


TASK [add-repo : set_fact] *****************************************************
ok: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]

skipping: [119.9.116.251]
skipping: [47.75.36.60]

TASK [add-repo : Read hostvars] ************************************************
changed: [23.99.120.65 -> localhost]


TASK [add-repo : Create Json Template] *****************************************
skipping: [23.99.120.65]

TASK [add-repo : Append Json Data] *********************************************

skipping: [23.99.120.65]

TASK [add-repo : remove ansible block] *****************************************
skipping: [23.99.120.65]


TASK [add-repo : get value for iptables] ***************************************
changed: [23.99.120.65 -> localhost]

TASK [add-repo : check data] ***************************************************
ok: [23.99.120.65 -> localhost]


TASK [add-repo : get value for ssh_keys] ***************************************
changed: [23.99.120.65 -> localhost]

TASK [add-repo : check data] ***************************************************

ok: [23.99.120.65 -> localhost]

TASK [add-repo : get value for filebeat] ***************************************
changed: [23.99.120.65 -> localhost]


TASK [add-repo : check data] ***************************************************
ok: [23.99.120.65 -> localhost]

TASK [add-repo : Copy Centos Base Repo] ****************************************
skipping: [119.9.104.50]

skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
skipping: [47.75.36.60]
ok: [23.99.120.65]


TASK [add-repo : install the latest version of yum-utils] **********************
ok: [47.75.36.60]
ok: [119.9.116.251]
ok: [13.70.23.40]

ok: [23.99.120.65]
ok: [119.9.104.50]
ok: [119.81.239.182]

TASK [add-repo : check if puppet is installed] *********************************

ok: [119.9.116.251]
ok: [47.75.36.60]
ok: [119.9.104.50]
ok: [119.81.239.182]
ok: [13.70.23.40]

ok: [23.99.120.65]

TASK [add-repo : include_tasks] ************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]

skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
skipping: [47.75.36.60]


TASK [add-repo : include_tasks] ************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]

skipping: [119.9.116.251]
skipping: [47.75.36.60]

TASK [add-repo : include_tasks] ************************************************
skipping: [23.99.120.65]

skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
included: /ansible/puppet/roles/add-repo/tasks/rpm-repo-cen7-64-bit.yml for 47.75.36.60


TASK [add-repo : Install Epel repo] ********************************************
changed: [47.75.36.60]

TASK [add-repo : Install Rpm repo] *********************************************

ok: [47.75.36.60]

TASK [add-repo : Importing RPMForge Key] ***************************************
 [WARNING]: Consider using the yum, dnf or zypper module rather than running
'rpm'.  If you need to use command because yum, dnf or zypper is insufficient

you can add 'warn: false' to this command task or set 'command_warnings=False'
in ansible.cfg to get rid of this message.
changed: [47.75.36.60]

TASK [puppet : set_fact] *******************************************************

ok: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]

skipping: [47.75.36.60]

TASK [puppet : Read hostvars] **************************************************
changed: [23.99.120.65 -> localhost]


TASK [puppet : Create Json Template] *******************************************
skipping: [23.99.120.65]

TASK [puppet : Append Json Data] ***********************************************
skipping: [23.99.120.65]


TASK [puppet : remove ansible block] *******************************************
skipping: [23.99.120.65]

TASK [puppet : get value for iptables] *****************************************

changed: [23.99.120.65 -> localhost]

TASK [puppet : check data] *****************************************************
ok: [23.99.120.65 -> localhost]


TASK [puppet : get value for ssh_keys] *****************************************
changed: [23.99.120.65 -> localhost]

TASK [puppet : check data] *****************************************************
ok: [23.99.120.65 -> localhost]


TASK [puppet : get value for filebeat] *****************************************
changed: [23.99.120.65 -> localhost]

TASK [puppet : check data] *****************************************************

ok: [23.99.120.65 -> localhost]

TASK [puppet : set_fact] *******************************************************
ok: [23.99.120.65]
ok: [119.9.104.50]

ok: [13.70.23.40]
ok: [119.81.239.182]
ok: [119.9.116.251]
ok: [47.75.36.60]


TASK [puppet : install curl] ***************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]

skipping: [119.9.116.251]
skipping: [47.75.36.60]

TASK [puppet : Get IP] *********************************************************
changed: [13.70.23.40]

changed: [119.9.104.50]
changed: [119.81.239.182]
changed: [119.9.116.251]
changed: [47.75.36.60]
changed: [23.99.120.65]


TASK [puppet : Get If IP is here] **********************************************
changed: [23.99.120.65 -> 161.202.63.231]
changed: [119.9.104.50 -> 161.202.63.231]
changed: [13.70.23.40 -> 161.202.63.231]

changed: [119.81.239.182 -> 161.202.63.231]
changed: [119.9.116.251 -> 161.202.63.231]
fatal: [47.75.36.60 -> 161.202.63.231]: FAILED! => {"changed": true, "cmd": ["grep", "47.75.36.60", "/etc/puppetlabs/code/environments/ruibonginx/manifests/00-defaults.pp"], "delta": "0:00:00.044653", "end": "2019-12-16 16:48:49.552717", "msg": "non-zero return code", "rc": 1, "start": "2019-12-16 16:48:49.508064", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : check if environment] *******************************************
changed: [23.99.120.65]
changed: [13.70.23.40]
changed: [119.9.104.50]
changed: [119.81.239.182]

fatal: [47.75.36.60]: FAILED! => {"changed": true, "cmd": ["grep", "ruibonginx", "/etc/puppetlabs/puppet/puppet.conf"], "delta": "0:00:00.032645", "end": "2019-12-16 16:48:50.854309", "msg": "non-zero return code", "rc": 2, "start": "2019-12-16 16:48:50.821664", "stderr": "grep: /etc/puppetlabs/puppet/puppet.conf: No such file or directory", "stderr_lines": ["grep: /etc/puppetlabs/puppet/puppet.conf: No such file or directory"], "stdout": "", "stdout_lines": []}
...ignoring
changed: [119.9.116.251]

TASK [puppet : pv] *************************************************************

fatal: [47.75.36.60]: FAILED! => {"changed": true, "cmd": "/opt/puppetlabs/bin/puppet --version", "delta": "0:00:00.033035", "end": "2019-12-16 16:48:52.278254", "msg": "non-zero return code", "rc": 127, "start": "2019-12-16 16:48:52.245219", "stderr": "/bin/sh: /opt/puppetlabs/bin/puppet: No such file or directory", "stderr_lines": ["/bin/sh: /opt/puppetlabs/bin/puppet: No such file or directory"], "stdout": "", "stdout_lines": []}
...ignoring
changed: [13.70.23.40]
changed: [119.81.239.182]
changed: [119.9.104.50]

changed: [119.9.116.251]
changed: [23.99.120.65]

TASK [puppet : get data] *******************************************************
skipping: [23.99.120.65]

skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
skipping: [47.75.36.60]


TASK [puppet : get data] *******************************************************
ok: [23.99.120.65]
ok: [119.9.104.50]
ok: [13.70.23.40]

ok: [119.81.239.182]
ok: [119.9.116.251]
ok: [47.75.36.60]

TASK [puppet : include_tasks] **************************************************

skipping: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]

included: /ansible/puppet/roles/puppet/tasks/remove3.yml for 47.75.36.60

TASK [puppet : Remove Old Puppet Service] **************************************
ok: [47.75.36.60]


TASK [puppet : Remove Old Puppet Repository] ***********************************
ok: [47.75.36.60]

TASK [puppet : Remove Old Puppet Files] ****************************************
ok: [47.75.36.60] => (item=/var/lib/puppet)

ok: [47.75.36.60] => (item=/etc/puppet)

TASK [puppet : include_tasks] **************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]

skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
included: /ansible/puppet/roles/puppet/tasks/remove.yml for 47.75.36.60


TASK [puppet : Remove for Now] *************************************************
ok: [47.75.36.60]

TASK [puppet : Install Puppet Repository] **************************************
skipping: [47.75.36.60]


TASK [puppet : Install Puppet Repository] **************************************
changed: [47.75.36.60]

TASK [puppet : Install Puppet Service] *****************************************

skipping: [47.75.36.60]

TASK [puppet : Install Puppet Service] *****************************************
changed: [47.75.36.60]


TASK [puppet : include_tasks] **************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]

skipping: [119.9.116.251]
skipping: [47.75.36.60]

TASK [puppet : include_tasks] **************************************************
skipping: [23.99.120.65]

skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
included: /ansible/puppet/roles/puppet/tasks/pupmaster.yml for 47.75.36.60


TASK [puppet : ubuntu] *********************************************************
skipping: [47.75.36.60]

TASK [puppet : ebet] ***********************************************************

skipping: [47.75.36.60]

TASK [puppet : Create append ruibonginx manifests] *****************************
changed: [47.75.36.60 -> localhost]


TASK [puppet : Append to ruibonginx manifests] *********************************
changed: [47.75.36.60 -> 161.202.63.231]

TASK [puppet : command] ********************************************************
changed: [47.75.36.60 -> 161.202.63.231]


TASK [puppet : reappend to ruibonginx manifests] *******************************
skipping: [47.75.36.60]

TASK [puppet : reappend to ruibonginx manifests again] *************************

skipping: [47.75.36.60]

TASK [puppet : Removing iptables on node] **************************************
skipping: [47.75.36.60]


TASK [puppet : Removing nginx on node] *****************************************
skipping: [47.75.36.60]

TASK [puppet : Truncate Midpay] ************************************************
skipping: [47.75.36.60]


TASK [puppet : Removing sshkeys on node] ***************************************
skipping: [47.75.36.60]

TASK [puppet : Removing filebeat on node] **************************************

skipping: [47.75.36.60]

TASK [puppet : include_tasks] **************************************************
skipping: [23.99.120.65]
skipping: [119.9.104.50]

skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
included: /ansible/puppet/roles/puppet/tasks/pupconfig.yml for 47.75.36.60


TASK [puppet : Add puppet conf] ************************************************
changed: [47.75.36.60]

TASK [puppet : include_tasks] **************************************************
skipping: [23.99.120.65]

skipping: [119.9.104.50]
skipping: [13.70.23.40]
skipping: [119.81.239.182]
skipping: [119.9.116.251]
included: /ansible/puppet/roles/puppet/tasks/cert.yml for 47.75.36.60


TASK [puppet : Kill Puppet] ****************************************************
fatal: [47.75.36.60]: FAILED! => {"changed": true, "cmd": ["killall", "-9", "puppet"], "delta": "0:00:00.047669", "end": "2019-12-16 16:49:33.929762", "msg": "non-zero return code", "rc": 1, "start": "2019-12-16 16:49:33.882093", "stderr": "puppet: no process found", "stderr_lines": ["puppet: no process found"], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : Remove Directory] ***********************************************
ok: [47.75.36.60]

TASK [puppet : Add Directory] **************************************************
changed: [47.75.36.60]

...ignoring

TASK [puppet : Wait Certs] *****************************************************
ok: [47.75.36.60]


MAX RETRIES EXECUTED, COMMAND NOT RESPONDING
TASK [puppet : lineinfile] *****************************************************
changed: [47.75.36.60]

TASK [puppet : Remove Certs] ***************************************************

fatal: [47.75.36.60 -> 161.202.63.231]: FAILED! => {"changed": true, "cmd": ["puppetserver", "ca", "clean", "--certname", "47.75.36.60"], "delta": "0:00:00.490788", "end": "2019-12-16 16:49:37.472659", "msg": "non-zero return code", "rc": 1, "start": "2019-12-16 16:49:36.981871", "stderr": "Error:\n    Could not find files to clean for 47.75.36.60", "stderr_lines": ["Error:", "    Could not find files to clean for 47.75.36.60"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : Generate Puppet Cert] *******************************************
fatal: [47.75.36.60]: FAILED! => {"changed": true, "cmd": ["/opt/puppetlabs/bin/puppet", "agent", "-t"], "delta": "0:00:05.850742", "end": "2019-12-16 16:49:43.954780", "msg": "non-zero return code", "rc": 1, "start": "2019-12-16 16:49:38.104038", "stderr": "", "stderr_lines": [], "stdout": "\u001b[0;32mInfo: Creating a new RSA SSL key for 47.75.36.60\u001b[0m\n\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m\n\u001b[0;32mInfo: Creating a new SSL certificate request for 47.75.36.60\u001b[0m\n\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 6D:9F:7D:61:BE:F3:72:F4:00:43:9D:FF:93:1A:A5:1F:B0:B5:43:61:87:22:C1:31:64:64:5C:91:2E:66:40:1C\u001b[0m\n\u001b[0;32mInfo: Certificate for 47.75.36.60 has not been signed yet\u001b[0m\nCouldn't fetch certificate from CA server; you might still need to sign this agent's certificate (47.75.36.60).\nExiting now because the waitforcert setting is set to 0.", "stdout_lines": ["\u001b[0;32mInfo: Creating a new RSA SSL key for 47.75.36.60\u001b[0m", "\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m", "\u001b[0;32mInfo: Creating a new SSL certificate request for 47.75.36.60\u001b[0m", "\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 6D:9F:7D:61:BE:F3:72:F4:00:43:9D:FF:93:1A:A5:1F:B0:B5:43:61:87:22:C1:31:64:64:5C:91:2E:66:40:1C\u001b[0m", "\u001b[0;32mInfo: Certificate for 47.75.36.60 has not been signed yet\u001b[0m", "Couldn't fetch certificate from CA server; you might still need to sign this agent's certificate (47.75.36.60).", "Exiting now because the waitforcert setting is set to 0."]}

