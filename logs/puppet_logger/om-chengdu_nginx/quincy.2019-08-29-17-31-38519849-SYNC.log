PUPPET_COMMAND_START
 [WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details

PLAY [puppetmaster] ************************************************************


TASK [puppetmaster : Read hostvars] ********************************************
changed: [161.202.63.231 -> localhost]

TASK [puppetmaster : Create Json Template] *************************************
skipping: [161.202.63.231]


TASK [puppetmaster : Append Json Data] *****************************************
skipping: [161.202.63.231]

TASK [puppetmaster : remove ansible block] *************************************

skipping: [161.202.63.231]

TASK [puppetmaster : get value for iptables] ***********************************
changed: [161.202.63.231 -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]

TASK [puppetmaster : get value for ssh_keys] ***********************************
changed: [161.202.63.231 -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]

TASK [puppetmaster : get value for filebeat] ***********************************

changed: [161.202.63.231 -> localhost]

TASK [puppetmaster : check data] ***********************************************
ok: [161.202.63.231 -> localhost]


TASK [puppetmaster : stat] *****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]


TASK [puppetmaster : stat] *****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : debug] ****************************************************

skipping: [161.202.63.231]

TASK [puppetmaster : stat] *****************************************************
skipping: [161.202.63.231]


TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : stat] *****************************************************
ok: [161.202.63.231 -> localhost]


TASK [puppetmaster : debug] ****************************************************
skipping: [161.202.63.231]

TASK [puppetmaster : set_fact] *************************************************

ok: [161.202.63.231]

TASK [puppetmaster : include_tasks] ********************************************
included: /ansible/puppet/roles/puppetmaster/tasks/puppetcreate.yml for 161.202.63.231


TASK [puppetmaster : Create sub directory] *************************************
ok: [161.202.63.231] => (item=modules)
ok: [161.202.63.231] => (item=manifests)

TASK [puppetmaster : Create IPTABLES Modules Manifests subdirectory] ***********

skipping: [161.202.63.231] => (item=manifests) 
skipping: [161.202.63.231] => (item=templates) 

TASK [puppetmaster : Create SSH_KEYS Modules Manifests subdirectory] ***********
skipping: [161.202.63.231] => (item=manifests) 

skipping: [161.202.63.231] => (item=templates) 

TASK [puppetmaster : Create STDLIB Modules Manifests subdirectory] *************
ok: [161.202.63.231]


TASK [puppetmaster : Create Filebeat Modules Manifests subdirectory] ***********
ok: [161.202.63.231] => (item=manifests)
ok: [161.202.63.231] => (item=templates)

TASK [puppetmaster : Provide puppet environment] *******************************

ok: [161.202.63.231]

TASK [puppetmaster : Check defaults manifests node] ****************************
ok: [161.202.63.231]


TASK [puppetmaster : Create defaults manifests] ********************************
skipping: [161.202.63.231]

TASK [puppetmaster : iptables modules] *****************************************
skipping: [161.202.63.231]


TASK [puppetmaster : ssh_keys modules] *****************************************
skipping: [161.202.63.231]

TASK [puppetmaster : filebeat modules] *****************************************

included: /ansible/puppet/roles/puppetmaster/tasks/filebeat.yml for 161.202.63.231

TASK [puppetmaster : Get filebeat config] **************************************
ok: [161.202.63.231]


TASK [puppetmaster : Get filebeat puppet] **************************************
ok: [161.202.63.231]

TASK [puppetmaster : Get rsyslog] **********************************************
ok: [161.202.63.231]


PLAY [om-chengdu_nginx] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [40.83.79.117]

ok: [47.112.127.70]

TASK [add-repo : set_fact] *****************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [add-repo : stat] *********************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [add-repo : debug] ********************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [add-repo : stat] *********************************************************

skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [add-repo : debug] ********************************************************
skipping: [47.112.127.70]

skipping: [40.83.79.117]

TASK [add-repo : stat] *********************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [add-repo : debug] ********************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [add-repo : stat] *********************************************************
ok: [47.112.127.70 -> localhost]
ok: [40.83.79.117 -> localhost]

TASK [add-repo : debug] ********************************************************

skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [add-repo : Copy Centos Base Repo] ****************************************
skipping: [47.112.127.70]

skipping: [40.83.79.117]

TASK [add-repo : install the latest version of yum-utils] **********************
ok: [47.112.127.70]
ok: [40.83.79.117]


TASK [add-repo : check if puppet is installed] *********************************
ok: [40.83.79.117]
ok: [47.112.127.70]


TASK [add-repo : include_tasks] ************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [add-repo : include_tasks] ************************************************

skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [add-repo : include_tasks] ************************************************
skipping: [47.112.127.70]

skipping: [40.83.79.117]

TASK [puppet : set_fact] *******************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [puppet : Read hostvars] **************************************************
changed: [47.112.127.70 -> localhost]
changed: [40.83.79.117 -> localhost]


TASK [puppet : Create Json Template] *******************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [puppet : Append Json Data] ***********************************************

skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [puppet : remove ansible block] *******************************************
skipping: [47.112.127.70]

skipping: [40.83.79.117]

TASK [puppet : get value for iptables] *****************************************
changed: [47.112.127.70 -> localhost]
changed: [40.83.79.117 -> localhost]


TASK [puppet : check data] *****************************************************
ok: [47.112.127.70 -> localhost]
ok: [40.83.79.117 -> localhost]


TASK [puppet : get value for ssh_keys] *****************************************
changed: [47.112.127.70 -> localhost]
changed: [40.83.79.117 -> localhost]

TASK [puppet : check data] *****************************************************

ok: [47.112.127.70 -> localhost]
ok: [40.83.79.117 -> localhost]

TASK [puppet : get value for filebeat] *****************************************
changed: [47.112.127.70 -> localhost]

changed: [40.83.79.117 -> localhost]

TASK [puppet : check data] *****************************************************
ok: [47.112.127.70 -> localhost]
ok: [40.83.79.117 -> localhost]


TASK [puppet : set_fact] *******************************************************
ok: [47.112.127.70]
ok: [40.83.79.117]


TASK [puppet : install curl] ***************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [puppet : Get IP] *********************************************************

changed: [40.83.79.117]
fatal: [47.112.127.70]: FAILED! => {"changed": true, "cmd": "curl --connect-timeout 5 --retry 5 ipinfo.io/ip", "delta": "0:00:04.727157", "end": "2019-08-29 17:33:06.291127", "msg": "non-zero return code", "rc": 7, "start": "2019-08-29 17:33:01.563970", "stderr": "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:--  0:00:04 --:--:--     0curl: (7) Failed connect to ipinfo.io:80; Operation now in progress", "stderr_lines": ["  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", "                                 Dload  Upload   Total   Spent    Left  Speed", "", "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", "  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0", "  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0", "  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0", "  0     0    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0", "  0     0    0     0    0     0      0      0 --:--:--  0:00:04 --:--:--     0curl: (7) Failed connect to ipinfo.io:80; Operation now in progress"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : Get If IP is here] **********************************************

changed: [47.112.127.70 -> 161.202.63.231]
fatal: [40.83.79.117 -> 161.202.63.231]: FAILED! => {"changed": true, "cmd": ["grep", "40.83.79.117", "/etc/puppetlabs/code/environments/omchengdunginx/manifests/00-defaults.pp"], "delta": "0:00:00.046022", "end": "2019-08-29 17:33:07.164621", "msg": "non-zero return code", "rc": 1, "start": "2019-08-29 17:33:07.118599", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : check if environment] *******************************************

changed: [47.112.127.70]
fatal: [40.83.79.117]: FAILED! => {"changed": true, "cmd": ["grep", "omchengdunginx", "/etc/puppetlabs/puppet/puppet.conf"], "delta": "0:00:00.027690", "end": "2019-08-29 17:33:08.394497", "msg": "non-zero return code", "rc": 1, "start": "2019-08-29 17:33:08.366807", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : pv] *************************************************************

changed: [47.112.127.70]
changed: [40.83.79.117]

TASK [puppet : get data] *******************************************************
skipping: [47.112.127.70]

skipping: [40.83.79.117]

TASK [puppet : get data] *******************************************************
ok: [47.112.127.70]
ok: [40.83.79.117]


TASK [puppet : include_tasks] **************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]


TASK [puppet : include_tasks] **************************************************
skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [puppet : include_tasks] **************************************************

skipping: [47.112.127.70]
skipping: [40.83.79.117]

TASK [puppet : include_tasks] **************************************************
skipping: [47.112.127.70]

included: /ansible/puppet/roles/puppet/tasks/pupmaster.yml for 40.83.79.117

TASK [puppet : ubuntu] *********************************************************
skipping: [40.83.79.117]


TASK [puppet : Create append omchengdunginx manifests] *************************
ok: [40.83.79.117 -> localhost]

TASK [puppet : Append to omchengdunginx manifests] *****************************
changed: [40.83.79.117 -> 161.202.63.231]


TASK [puppet : command] ********************************************************
changed: [40.83.79.117 -> 161.202.63.231]

TASK [puppet : reappend to omchengdunginx manifests] ***************************

skipping: [40.83.79.117]

TASK [puppet : reappend to omchengdunginx manifests again] *********************
skipping: [40.83.79.117]


TASK [puppet : Removing iptables on node] **************************************
changed: [40.83.79.117 -> 161.202.63.231]

TASK [puppet : Removing nginx on node] *****************************************
skipping: [40.83.79.117]


TASK [puppet : Truncate Midpay] ************************************************
skipping: [40.83.79.117]

TASK [puppet : Removing sshkeys on node] ***************************************

skipping: [40.83.79.117]

TASK [puppet : Removing filebeat on node] **************************************
skipping: [40.83.79.117]


TASK [puppet : include_tasks] **************************************************
skipping: [47.112.127.70]
included: /ansible/puppet/roles/puppet/tasks/pupconfig.yml for 40.83.79.117

TASK [puppet : Add puppet conf] ************************************************

changed: [40.83.79.117]

TASK [puppet : include_tasks] **************************************************
skipping: [47.112.127.70]
included: /ansible/puppet/roles/puppet/tasks/cert.yml for 40.83.79.117


TASK [puppet : Kill Puppet] ****************************************************
fatal: [40.83.79.117]: FAILED! => {"changed": true, "cmd": ["killall", "-9", "puppet"], "delta": "0:00:00.031319", "end": "2019-08-29 17:33:24.760766", "msg": "non-zero return code", "rc": 1, "start": "2019-08-29 17:33:24.729447", "stderr": "puppet: no process found", "stderr_lines": ["puppet: no process found"], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : Remove Directory] ***********************************************
changed: [40.83.79.117]

TASK [puppet : Add Directory] **************************************************
changed: [40.83.79.117]


TASK [puppet : lineinfile] *****************************************************
ok: [40.83.79.117]

TASK [puppet : Remove Certs] ***************************************************

changed: [40.83.79.117 -> 161.202.63.231]

TASK [puppet : Generate Puppet Cert] *******************************************
fatal: [40.83.79.117]: FAILED! => {"changed": true, "cmd": ["/opt/puppetlabs/bin/puppet", "agent", "-t"], "delta": "0:00:04.835581", "end": "2019-08-29 17:33:36.995725", "msg": "non-zero return code", "rc": 1, "start": "2019-08-29 17:33:32.160144", "stderr": "", "stderr_lines": [], "stdout": "\u001b[0;32mInfo: Downloaded certificate for ca from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m\n\u001b[0;32mInfo: Downloaded certificate revocation list for ca from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m\n\u001b[0;32mInfo: Creating a new RSA SSL key for 40.83.79.117\u001b[0m\n\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m\n\u001b[0;32mInfo: Creating a new SSL certificate request for 40.83.79.117\u001b[0m\n\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 51:F3:A7:38:A5:41:53:83:51:EC:B4:B1:9A:92:58:6A:42:26:73:2F:76:BD:E7:EA:34:FB:A3:75:B4:5E:CD:5A\u001b[0m\n\u001b[0;32mInfo: Certificate for 40.83.79.117 has not been signed yet\u001b[0m\nCouldn't fetch certificate from CA server; you might still need to sign this agent's certificate (40.83.79.117).\nExiting now because the waitforcert setting is set to 0.", "stdout_lines": ["\u001b[0;32mInfo: Downloaded certificate for ca from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m", "\u001b[0;32mInfo: Downloaded certificate revocation list for ca from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m", "\u001b[0;32mInfo: Creating a new RSA SSL key for 40.83.79.117\u001b[0m", "\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m", "\u001b[0;32mInfo: Creating a new SSL certificate request for 40.83.79.117\u001b[0m", "\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 51:F3:A7:38:A5:41:53:83:51:EC:B4:B1:9A:92:58:6A:42:26:73:2F:76:BD:E7:EA:34:FB:A3:75:B4:5E:CD:5A\u001b[0m", "\u001b[0;32mInfo: Certificate for 40.83.79.117 has not been signed yet\u001b[0m", "Couldn't fetch certificate from CA server; you might still need to sign this agent's certificate (40.83.79.117).", "Exiting now because the waitforcert setting is set to 0."]}
...ignoring

PUPPET_COMMAND_END
MAX RETRIES EXECUTED, COMMAND NOT RESPONDING
TASK [puppet : Wait Certs] *****************************************************
ok: [40.83.79.117]

TASK [puppet : Add certs to Master] ********************************************

changed: [40.83.79.117 -> 161.202.63.231]

TASK [puppet : Puppet Cert Run] ************************************************
fatal: [40.83.79.117]: FAILED! => {"changed": true, "cmd": ["/opt/puppetlabs/bin/puppet", "agent", "-t"], "delta": "0:00:06.194952", "end": "2019-08-29 17:33:57.852719", "msg": "non-zero return code", "rc": 2, "start": "2019-08-29 17:33:51.657767", "stderr": "", "stderr_lines": [], "stdout": "\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m\n\u001b[0;32mInfo: Creating a new SSL certificate request for 40.83.79.117\u001b[0m\n\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 51:F3:A7:38:A5:41:53:83:51:EC:B4:B1:9A:92:58:6A:42:26:73:2F:76:BD:E7:EA:34:FB:A3:75:B4:5E:CD:5A\u001b[0m\n\u001b[0;32mInfo: Downloaded certificate for 40.83.79.117 from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m\n\u001b[0;32mInfo: Using configured environment 'omchengdunginx'\u001b[0m\n\u001b[0;32mInfo: Retrieving pluginfacts\u001b[0m\n\u001b[0;32mInfo: Retrieving plugin\u001b[0m\n\u001b[0;32mInfo: Retrieving locales\u001b[0m\n\u001b[0;32mInfo: Loading facts\u001b[0m\n\u001b[0;32mInfo: Caching catalog for 40.83.79.117\u001b[0m\n\u001b[0;32mInfo: Applying configuration version '1567071236'\u001b[0m\n\u001b[mNotice: /Stage[main]/Running_services::Service/Service[puppet]/ensure: ensure changed 'stopped' to 'running' (corrective)\u001b[0m\n\u001b[0;32mInfo: /Stage[main]/Running_services::Service/Service[puppet]: Unscheduling refresh on Service[puppet]\u001b[0m\n\u001b[mNotice: Applied catalog in 0.93 seconds\u001b[0m", "stdout_lines": ["\u001b[0;32mInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\u001b[0m", "\u001b[0;32mInfo: Creating a new SSL certificate request for 40.83.79.117\u001b[0m", "\u001b[0;32mInfo: Certificate Request fingerprint (SHA256): 51:F3:A7:38:A5:41:53:83:51:EC:B4:B1:9A:92:58:6A:42:26:73:2F:76:BD:E7:EA:34:FB:A3:75:B4:5E:CD:5A\u001b[0m", "\u001b[0;32mInfo: Downloaded certificate for 40.83.79.117 from om-puppetmaster1.hk.sl.monaco1.me\u001b[0m", "\u001b[0;32mInfo: Using configured environment 'omchengdunginx'\u001b[0m", "\u001b[0;32mInfo: Retrieving pluginfacts\u001b[0m", "\u001b[0;32mInfo: Retrieving plugin\u001b[0m", "\u001b[0;32mInfo: Retrieving locales\u001b[0m", "\u001b[0;32mInfo: Loading facts\u001b[0m", "\u001b[0;32mInfo: Caching catalog for 40.83.79.117\u001b[0m", "\u001b[0;32mInfo: Applying configuration version '1567071236'\u001b[0m", "\u001b[mNotice: /Stage[main]/Running_services::Service/Service[puppet]/ensure: ensure changed 'stopped' to 'running' (corrective)\u001b[0m", "\u001b[0;32mInfo: /Stage[main]/Running_services::Service/Service[puppet]: Unscheduling refresh on Service[puppet]\u001b[0m", "\u001b[mNotice: Applied catalog in 0.93 seconds\u001b[0m"]}
...ignoring


TASK [puppet : include_tasks] **************************************************
included: /ansible/puppet/roles/puppet/tasks/start.yml for 47.112.127.70, 40.83.79.117

TASK [puppet : Start service puppet, if not running] ***************************

ok: [40.83.79.117]
changed: [47.112.127.70]

TASK [puppet : Enable puppet services] *****************************************
ok: [40.83.79.117]

ok: [47.112.127.70]

PLAY [om-chengdu_nginx] ********************************************************

TASK [Kill Old Puppet Agent] ***************************************************

changed: [47.112.127.70]
changed: [40.83.79.117]

TASK [Generate Puppet Cert] ****************************************************
changed: [40.83.79.117]

changed: [47.112.127.70]

PLAY [127.0.0.1] ***************************************************************

TASK [sync_to_git : Read hostvars] *********************************************

changed: [localhost -> localhost]

TASK [sync_to_git : Create Json Template] **************************************
skipping: [localhost]


TASK [sync_to_git : Append Json Data] ******************************************
skipping: [localhost]

TASK [sync_to_git : remove ansible block] **************************************
skipping: [localhost]


TASK [sync_to_git : get value for iptables] ************************************
changed: [localhost -> localhost]

TASK [sync_to_git : check data] ************************************************

ok: [localhost -> localhost]

TASK [sync_to_git : get value for ssh_keys] ************************************
changed: [localhost -> localhost]


TASK [sync_to_git : check data] ************************************************
ok: [localhost -> localhost]

TASK [sync_to_git : get value for filebeat] ************************************
changed: [localhost -> localhost]


TASK [sync_to_git : check data] ************************************************
ok: [localhost -> localhost]

TASK [sync_to_git : Synchronizing Puppet template To GIT] **********************

skipping: [localhost]

TASK [sync_to_git : debug] *****************************************************
skipping: [localhost]


PLAY RECAP *********************************************************************
161.202.63.231             : ok=19   changed=4    unreachable=0    failed=0    skipped=15   rescued=0    ignored=0   
40.83.79.117               : ok=39   changed=21   unreachable=0    failed=0    skipped=28   rescued=0    ignored=5   
47.112.127.70              : ok=22   changed=11   unreachable=0    failed=0    skipped=24   rescued=0    ignored=1   
localhost                  : ok=7    changed=4    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   



