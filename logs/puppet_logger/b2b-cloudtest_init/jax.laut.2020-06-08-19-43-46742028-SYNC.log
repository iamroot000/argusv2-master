PUPPET_COMMAND_START
 [WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details

PLAY [puppmaster-b2b] **********************************************************


TASK [puppetmaster : Read hostvars] ********************************************
changed: [puppmaster-b2b -> localhost]

TASK [puppetmaster : Create Json Template] *************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : Append Json Data] *****************************************
skipping: [puppmaster-b2b]

TASK [puppetmaster : remove ansible block] *************************************

skipping: [puppmaster-b2b]

TASK [puppetmaster : get value for iptables] ***********************************
changed: [puppmaster-b2b -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [puppmaster-b2b -> localhost]

TASK [puppetmaster : get value for ssh_keys] ***********************************
changed: [puppmaster-b2b -> localhost]


TASK [puppetmaster : check data] ***********************************************
ok: [puppmaster-b2b -> localhost]

TASK [puppetmaster : get value for filebeat] ***********************************

changed: [puppmaster-b2b -> localhost]

TASK [puppetmaster : check data] ***********************************************
ok: [puppmaster-b2b -> localhost]


TASK [puppetmaster : stat] *****************************************************
skipping: [puppmaster-b2b]

TASK [puppetmaster : debug] ****************************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : stat] *****************************************************
ok: [puppmaster-b2b -> localhost]

TASK [puppetmaster : debug] ****************************************************

skipping: [puppmaster-b2b]

TASK [puppetmaster : stat] *****************************************************
ok: [puppmaster-b2b -> localhost]


TASK [puppetmaster : debug] ****************************************************
skipping: [puppmaster-b2b]

TASK [puppetmaster : stat] *****************************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : debug] ****************************************************
skipping: [puppmaster-b2b]

TASK [puppetmaster : set_fact] *************************************************

ok: [puppmaster-b2b]

TASK [puppetmaster : include_tasks] ********************************************
included: /ansible/puppet/roles/puppetmaster/tasks/puppetcreate.yml for puppmaster-b2b


TASK [puppetmaster : Create sub directory] *************************************
changed: [puppmaster-b2b] => (item=modules)
changed: [puppmaster-b2b] => (item=manifests)

TASK [puppetmaster : Create IPTABLES Modules Manifests subdirectory] ***********

skipping: [puppmaster-b2b] => (item=manifests) 
skipping: [puppmaster-b2b] => (item=templates) 

TASK [puppetmaster : Create SSH_KEYS Modules Manifests subdirectory] ***********
changed: [puppmaster-b2b] => (item=manifests)

changed: [puppmaster-b2b] => (item=templates)

TASK [puppetmaster : Create STDLIB Modules Manifests subdirectory] *************
changed: [puppmaster-b2b]


TASK [puppetmaster : Create Filebeat Modules Manifests subdirectory] ***********
skipping: [puppmaster-b2b] => (item=manifests) 
skipping: [puppmaster-b2b] => (item=templates) 

TASK [puppetmaster : Provide puppet environment] *******************************

changed: [puppmaster-b2b]

TASK [puppetmaster : Check defaults manifests node] ****************************
ok: [puppmaster-b2b]


TASK [puppetmaster : Create defaults manifests] ********************************
changed: [puppmaster-b2b]

TASK [puppetmaster : iptables modules] *****************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : ssh_keys modules] *****************************************
included: /ansible/puppet/roles/puppetmaster/tasks/ssh_keys.yml for puppmaster-b2b

TASK [puppetmaster : Get Additional IP] ****************************************

changed: [puppmaster-b2b -> localhost]

TASK [puppetmaster : User] *****************************************************
ok: [puppmaster-b2b]


TASK [puppetmaster : User] *****************************************************
ok: [puppmaster-b2b]

TASK [puppetmaster : ssh-password-auth] ****************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : Append users] *********************************************
skipping: [puppmaster-b2b]

TASK [puppetmaster : Append users b2b dc] **************************************

ok: [puppmaster-b2b]

TASK [puppetmaster : Append users b2b] *****************************************
skipping: [puppmaster-b2b]


TASK [puppetmaster : Get sshd config config] ***********************************
changed: [puppmaster-b2b]

TASK [puppetmaster : Get sshd puppet] ******************************************
changed: [puppmaster-b2b]


TASK [puppetmaster : Get ssh keys] *********************************************
changed: [puppmaster-b2b]

TASK [puppetmaster : Get ssh keys] *********************************************

changed: [puppmaster-b2b]

TASK [puppetmaster : Get ssh root keys] ****************************************
changed: [puppmaster-b2b]


TASK [puppetmaster : filebeat modules] *****************************************
skipping: [puppmaster-b2b]

PLAY [b2b-cloudtest_init] ******************************************************


TASK [Gathering Facts] *********************************************************
ok: [47.52.1.250]

TASK [add-repo : set_fact] *****************************************************
skipping: [47.52.1.250]


TASK [add-repo : Read hostvars] ************************************************
changed: [47.52.1.250 -> localhost]

TASK [add-repo : Create Json Template] *****************************************

skipping: [47.52.1.250]

TASK [add-repo : Append Json Data] *********************************************
skipping: [47.52.1.250]


TASK [add-repo : remove ansible block] *****************************************
skipping: [47.52.1.250]

TASK [add-repo : get value for iptables] ***************************************
changed: [47.52.1.250 -> localhost]


TASK [add-repo : check data] ***************************************************
ok: [47.52.1.250 -> localhost]

TASK [add-repo : get value for ssh_keys] ***************************************

changed: [47.52.1.250 -> localhost]

TASK [add-repo : check data] ***************************************************
ok: [47.52.1.250 -> localhost]


TASK [add-repo : get value for filebeat] ***************************************
changed: [47.52.1.250 -> localhost]

TASK [add-repo : check data] ***************************************************
ok: [47.52.1.250 -> localhost]


TASK [add-repo : Copy Centos Base Repo] ****************************************
skipping: [47.52.1.250]

TASK [add-repo : install the latest version of yum-utils] **********************

ok: [47.52.1.250]

TASK [add-repo : check if puppet is installed] *********************************
 [WARNING]: Consider using the yum module rather than running 'yum'.  If you
need to use command because yum is insufficient you can add 'warn: false' to

this command task or set 'command_warnings=False' in ansible.cfg to get rid of
this message.
fatal: [47.52.1.250]: FAILED! => {"changed": true, "cmd": "yum list installed|grep puppet-agent", "delta": "0:00:00.944091", "end": "2020-06-08 19:44:42.990131", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:44:42.046040", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring


TASK [add-repo : include_tasks] ************************************************
skipping: [47.52.1.250]

TASK [add-repo : include_tasks] ************************************************
skipping: [47.52.1.250]


TASK [add-repo : include_tasks] ************************************************
included: /ansible/puppet/roles/add-repo/tasks/rpm-repo-cen7-64-bit.yml for 47.52.1.250

TASK [add-repo : Install Epel repo] ********************************************

ok: [47.52.1.250]

TASK [add-repo : Install Rpm repo] *********************************************
changed: [47.52.1.250]


TASK [add-repo : Importing RPMForge Key] ***************************************
 [WARNING]: Consider using the yum, dnf or zypper module rather than running
'rpm'.  If you need to use command because yum, dnf or zypper is insufficient
you can add 'warn: false' to this command task or set 'command_warnings=False'
in ansible.cfg to get rid of this message.

changed: [47.52.1.250]

TASK [puppet : set_fact] *******************************************************
skipping: [47.52.1.250]


TASK [puppet : Read hostvars] **************************************************
changed: [47.52.1.250 -> localhost]

TASK [puppet : Create Json Template] *******************************************
skipping: [47.52.1.250]


TASK [puppet : Append Json Data] ***********************************************
skipping: [47.52.1.250]

TASK [puppet : remove ansible block] *******************************************

skipping: [47.52.1.250]

TASK [puppet : get value for iptables] *****************************************
changed: [47.52.1.250 -> localhost]


TASK [puppet : check data] *****************************************************
ok: [47.52.1.250 -> localhost]

TASK [puppet : get value for ssh_keys] *****************************************
changed: [47.52.1.250 -> localhost]


TASK [puppet : check data] *****************************************************
ok: [47.52.1.250 -> localhost]

TASK [puppet : get value for filebeat] *****************************************

changed: [47.52.1.250 -> localhost]

TASK [puppet : check data] *****************************************************
ok: [47.52.1.250 -> localhost]


TASK [puppet : set_fact] *******************************************************
ok: [47.52.1.250]

TASK [puppet : install curl] ***************************************************
skipping: [47.52.1.250]


TASK [puppet : Get IP b2b dc] **************************************************
skipping: [47.52.1.250]

TASK [puppet : Get ipset] ******************************************************

skipping: [47.52.1.250]

TASK [puppet : Get IP] *********************************************************
 [WARNING]: Consider using the get_url or uri module rather than running
'curl'.  If you need to use command because get_url or uri is insufficient you

can add 'warn: false' to this command task or set 'command_warnings=False' in
ansible.cfg to get rid of this message.
changed: [47.52.1.250]

TASK [puppet : Get ipset] ******************************************************

ok: [47.52.1.250]

TASK [puppet : Get ipset] ******************************************************
ok: [47.52.1.250] => {
    "msg": "47.52.1.250"

}

TASK [puppet : Get If IP is here] **********************************************
fatal: [47.52.1.250 -> 161.202.63.231]: FAILED! => {"changed": true, "cmd": ["grep", "47.52.1.250", "/etc/puppetlabs/code/environments/b2bcloudtestinit/manifests/00-defaults.pp"], "delta": "0:00:00.044401", "end": "2020-06-08 19:44:57.112591", "msg": "non-zero return code", "rc": 2, "start": "2020-06-08 19:44:57.068190", "stderr": "grep: /etc/puppetlabs/code/environments/b2bcloudtestinit/manifests/00-defaults.pp: No such file or directory", "stderr_lines": ["grep: /etc/puppetlabs/code/environments/b2bcloudtestinit/manifests/00-defaults.pp: No such file or directory"], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : check if environment] *******************************************
fatal: [47.52.1.250]: FAILED! => {"changed": true, "cmd": ["grep", "b2bcloudtestinit", "/etc/puppetlabs/puppet/puppet.conf"], "delta": "0:00:00.119592", "end": "2020-06-08 19:44:57.855433", "msg": "non-zero return code", "rc": 2, "start": "2020-06-08 19:44:57.735841", "stderr": "grep: /etc/puppetlabs/puppet/puppet.conf: No such file or directory", "stderr_lines": ["grep: /etc/puppetlabs/puppet/puppet.conf: No such file or directory"], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : pv] *************************************************************
fatal: [47.52.1.250]: FAILED! => {"changed": true, "cmd": "/opt/puppetlabs/bin/puppet --version", "delta": "0:00:00.118197", "end": "2020-06-08 19:44:58.598506", "msg": "non-zero return code", "rc": 127, "start": "2020-06-08 19:44:58.480309", "stderr": "/bin/sh: /opt/puppetlabs/bin/puppet: No such file or directory", "stderr_lines": ["/bin/sh: /opt/puppetlabs/bin/puppet: No such file or directory"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : get data] *******************************************************

skipping: [47.52.1.250]

TASK [puppet : get data] *******************************************************
ok: [47.52.1.250]


TASK [puppet : include_tasks] **************************************************
included: /ansible/puppet/roles/puppet/tasks/remove3.yml for 47.52.1.250

TASK [puppet : Remove Old Puppet Service] **************************************
ok: [47.52.1.250]


TASK [puppet : Remove Old Puppet Repository] ***********************************
ok: [47.52.1.250]

TASK [puppet : Remove Old Puppet Files] ****************************************

ok: [47.52.1.250] => (item=/var/lib/puppet)
ok: [47.52.1.250] => (item=/etc/puppet)

TASK [puppet : include_tasks] **************************************************
included: /ansible/puppet/roles/puppet/tasks/remove.yml for 47.52.1.250


TASK [puppet : Remove for Now] *************************************************
ok: [47.52.1.250]

TASK [puppet : Install Puppet Repository] **************************************

skipping: [47.52.1.250]

TASK [puppet : Install Puppet Repository] **************************************
changed: [47.52.1.250]


TASK [puppet : Install Puppet Service] *****************************************
skipping: [47.52.1.250]

TASK [puppet : Install Puppet Service] *****************************************
changed: [47.52.1.250]


TASK [puppet : include_tasks] **************************************************
skipping: [47.52.1.250]

TASK [puppet : include_tasks] **************************************************

included: /ansible/puppet/roles/puppet/tasks/pupmaster.yml for 47.52.1.250

TASK [puppet : Get if ip exclude] **********************************************
fatal: [47.52.1.250 -> localhost]: FAILED! => {"changed": true, "cmd": "cat /ansible/puppet/ipexclude|grep 47.52.1.250", "delta": "0:00:00.165585", "end": "2020-06-08 19:45:31.698075", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:45:31.532490", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : set ipexclude] **************************************************
skipping: [47.52.1.250]

TASK [puppet : ubuntu] *********************************************************

skipping: [47.52.1.250]

TASK [puppet : ebet] ***********************************************************
skipping: [47.52.1.250]


TASK [puppet : b2b] ************************************************************
ok: [47.52.1.250]

TASK [puppet : Create append b2bcloudtestinit manifests] ***********************
changed: [47.52.1.250 -> localhost]


TASK [puppet : Append to b2bcloudtestinit manifests] ***************************
changed: [47.52.1.250 -> None]

TASK [puppet : command] ********************************************************

changed: [47.52.1.250 -> None]

TASK [puppet : reappend to b2bcloudtestinit manifests] *************************
skipping: [47.52.1.250]


TASK [puppet : reappend to b2bcloudtestinit manifests again] *******************
skipping: [47.52.1.250]

TASK [puppet : Removing iptables on node] **************************************
changed: [47.52.1.250 -> None]


TASK [puppet : Removing nginx on node] *****************************************
skipping: [47.52.1.250]

TASK [puppet : Truncate Midpay] ************************************************

skipping: [47.52.1.250]

TASK [puppet : Removing sshkeys on node] ***************************************
skipping: [47.52.1.250]


TASK [puppet : Removing filebeat on node] **************************************
changed: [47.52.1.250 -> None]

TASK [puppet : include_tasks] **************************************************
included: /ansible/puppet/roles/puppet/tasks/pupconfig.yml for 47.52.1.250


TASK [puppet : Change server if b2b] *******************************************
ok: [47.52.1.250]

TASK [puppet : Add puppet conf] ************************************************

changed: [47.52.1.250]

TASK [puppet : include_tasks] **************************************************
included: /ansible/puppet/roles/puppet/tasks/cert.yml for 47.52.1.250


TASK [puppet : stop Puppet] ****************************************************
ok: [47.52.1.250]

TASK [puppet : Kill Puppet] ****************************************************
fatal: [47.52.1.250]: FAILED! => {"changed": true, "cmd": ["killall", "-9", "puppet"], "delta": "0:00:00.137385", "end": "2020-06-08 19:45:44.361039", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:45:44.223654", "stderr": "puppet: no process found", "stderr_lines": ["puppet: no process found"], "stdout": "", "stdout_lines": []}

...ignoring

TASK [puppet : Remove Directory] ***********************************************
ok: [47.52.1.250]


TASK [puppet : Add Directory] **************************************************
changed: [47.52.1.250]

TASK [puppet : lineinfile] *****************************************************
changed: [47.52.1.250]


TASK [puppet : Remove Certs] ***************************************************
fatal: [47.52.1.250 -> None]: FAILED! => {"changed": true, "cmd": ["puppetserver", "ca", "clean", "--certname", "47.52.1.250"], "delta": "0:00:00.299990", "end": "2020-06-08 19:45:47.146681", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:45:46.846691", "stderr": "Error:\n    Could not find files to clean for 47.52.1.250", "stderr_lines": ["Error:", "    Could not find files to clean for 47.52.1.250"], "stdout": "", "stdout_lines": []}
...ignoring


TASK [puppet : Generate Puppet Cert] *******************************************
fatal: [47.52.1.250]: FAILED! => {"changed": true, "cmd": ["/opt/puppetlabs/bin/puppet", "agent", "-t"], "delta": "0:00:09.291378", "end": "2020-06-08 19:45:57.003746", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:45:47.712368", "stderr": "\u001b[1;31mError: Request to https://b2b-puppetmaster1.hk.hgc.monaco1.me:8140/puppet-ca/v1 failed after 7.021 seconds: Failed to open TCP connection to b2b-puppetmaster1.hk.hgc.monaco1.me:8140 (Connection timed out - connect(2) for \"b2b-puppetmaster1.hk.hgc.monaco1.me\" port 8140)\nWrapped exception:\nFailed to open TCP connection to b2b-puppetmaster1.hk.hgc.monaco1.me:8140 (Connection timed out - connect(2) for \"b2b-puppetmaster1.hk.hgc.monaco1.me\" port 8140)\u001b[0m\n\u001b[1;31mError: No more routes to ca\u001b[0m\n\u001b[1;31mError: Could not run: No more routes to ca\u001b[0m", "stderr_lines": ["\u001b[1;31mError: Request to https://b2b-puppetmaster1.hk.hgc.monaco1.me:8140/puppet-ca/v1 failed after 7.021 seconds: Failed to open TCP connection to b2b-puppetmaster1.hk.hgc.monaco1.me:8140 (Connection timed out - connect(2) for \"b2b-puppetmaster1.hk.hgc.monaco1.me\" port 8140)", "Wrapped exception:", "Failed to open TCP connection to b2b-puppetmaster1.hk.hgc.monaco1.me:8140 (Connection timed out - connect(2) for \"b2b-puppetmaster1.hk.hgc.monaco1.me\" port 8140)\u001b[0m", "\u001b[1;31mError: No more routes to ca\u001b[0m", "\u001b[1;31mError: Could not run: No more routes to ca\u001b[0m"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [puppet : Wait Certs] *****************************************************

ok: [47.52.1.250]

TASK [puppet : Add certs to Master] ********************************************
fatal: [47.52.1.250 -> None]: FAILED! => {"changed": true, "cmd": ["puppetserver", "ca", "sign", "--certname", "47.52.1.250"], "delta": "0:00:00.305613", "end": "2020-06-08 19:46:09.056007", "msg": "non-zero return code", "rc": 1, "start": "2020-06-08 19:46:08.750394", "stderr": "Error:\n    Could not find certificate request for 47.52.1.250", "stderr_lines": ["Error:", "    Could not find certificate request for 47.52.1.250"], "stdout": "", "stdout_lines": []}


PLAY RECAP *********************************************************************
47.52.1.250                : ok=57   changed=29   unreachable=0    failed=1    skipped=26   rescued=0    ignored=8   
puppmaster-b2b             : ok=27   changed=15   unreachable=0    failed=0    skipped=16   rescued=0    ignored=0   


PUPPET_COMMAND_END
MAX RETRIES EXECUTED, COMMAND NOT RESPONDING