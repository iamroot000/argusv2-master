--- /ansible/nginx/hostgroups/sabang-prod/nginx/conf.d/include/douji-web-promote.include	2021-04-26 16:53:02.964479387 +0800
+++ /tmp/douji-web-promote.include	2021-04-26 16:59:40.456844486 +0800
@@ -16,9 +16,17 @@
 	if ($host ~* pc\.(.*))
         { set $upstream douji-web; }
 
+		if ($http_user_agent ~* "Baiduspider|twitterbot|facebookexternalhit|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator|bingbot|Sosospider|Sogou Pic Spider|Googlebot|360Spider") {
+        proxy_set_header  Host            $host:$proxy_port;
+proxy_set_header  X-Real-IP       $remote_addr;
+proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
+  
+  		proxy_pass  http://spider_server;
+      }
+
         if ($http_user_agent ~* "qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot")
         {
-                 proxy_pass http://spider_server;
+                 return 403;
         }
 		
 		

