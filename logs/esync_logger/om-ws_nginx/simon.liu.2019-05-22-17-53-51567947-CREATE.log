--- /ansible/nginx/hostgroups/om-ws_nginx/nginx/conf.d/include/ws_official_masterconfig.include	2019-05-22 17:53:12.871255189 +0800
+++ /tmp/ws_official_masterconfig.include	2019-05-22 17:53:51.366255189 +0800
@@ -1,4 +1,50 @@
+if ($allowed_country ~ "no" ){
+        set $test BLOCK;
+}
 
+if ($allowed_country ~ "yes" ){
+        set $test ALLOW;
+}
+if ($allowed_ip ~ "yes" ){
+        set $test ALLOW;
+}
+if ($geoip_country_code ~ "PH|TW" ){
+        set $testtemp A;
+}
 
+if ($host ~ "kbl777.com|kbl178.net" ){
+        set $testtemp "${testtemp}B";
+}
 
+if ($testtemp = AB){
+        set $test ALLOW;
+}
 
+################ $HOST CONDITION
+if ($geoip_country_code ~ "PH|TW|HK|MO" ){
+        set $testtemp C;
+}
+
+if ($host ~ "kingbaly.today|kingbaly.email" ){
+        set $testtemp "${testtemp}D";
+}
+
+if ($testtemp = CD){
+        set $test ALLOW;
+}
+
+if ( $test = "BLOCK" ) { return 403;  }
+
+location /websocket {
+        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
+        proxy_set_header X-Real-IP  $remote_addr;
+        proxy_next_upstream http_502 http_504 http_404 error timeout invalid_header;
+        proxy_set_header Host $host:$server_port;
+        proxy_http_version 1.1;
+        proxy_set_header Upgrade $http_upgrade;
+        proxy_set_header Connection $connection_upgrade;
+        proxy_connect_timeout   1800;
+        proxy_send_timeout      1800;
+        proxy_read_timeout      1800;
+        proxy_pass http://9280;
+}

