--- /ansible/nginx/hostgroups/om-fpms_pms_nginx/nginx/conf.d/include/autopay_official_masterconfig.include	2020-12-30 15:35:25.254154045 +0800
+++ /tmp/autopay_official_masterconfig.include	2020-12-30 15:37:03.336634668 +0800
@@ -1,16 +1,42 @@
+ set $tag 0;
+      #  if ($geoip2_data_city_name ~* 'Yunnan'){
+      #     set $tag "${tag}1";
+      #   }
 
+	if ($geoip_region ~* '29'){
+	set $tag "${tag}1";
+#	return 403;
+	}
 
 
+	 if ($allowed_vpn_ip ~ 'yes'){
+           set $tag "${tag}2";
+        }
+
+        if ($tag !~* '01|02'){
+           return 403;
+        }
+
+        location /myip {
+         default_type text/plain;
+#         return 200 "$remote_addr $geoip_country_name $geoip_country_code $geoip_city $geoip2_data_city_name";
+         return 200 "$remote_addr $geoip_country_name $geoip_country_code $geoip_city $geoip_region ";
+       }
+
+        location ~ ^/(WEB-INF)/ {
+            deny all;
+        }
+
         location / {
 			proxy_next_upstream http_502 http_504 error timeout invalid_header;
-			proxy_redirect          off; 
-			proxy_set_header        Host            $host; 
+			proxy_redirect          off;
+			proxy_set_header        Host            $host;
 			proxy_set_header        X-Real-IP       $remote_addr;
 			proxy_set_header        referer         "";
-			proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for; 
-			proxy_connect_timeout   80; 
-			proxy_send_timeout      80; 
-			proxy_read_timeout      80; 
+			proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
+			proxy_connect_timeout   80;
+			proxy_send_timeout      80;
+			proxy_read_timeout      80;
 			client_max_body_size    35m;
 			client_body_buffer_size 256k;
 			proxy_buffer_size       256k;
@@ -19,4 +45,7 @@
 			proxy_temp_file_write_size      256k;
 			proxy_pass http://autopay;
         }
-  
\ No newline at end of file
+
+		location  ^~ /api/addTransactionTask {
+            deny    all;
+		}
\ No newline at end of file

