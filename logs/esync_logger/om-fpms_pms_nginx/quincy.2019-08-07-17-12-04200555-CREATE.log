--- /ansible/nginx/hostgroups/om-fpms_pms_nginx/nginx/conf.d/other/payhome.site.conf	2019-08-07 17:09:35.240905944 +0800
+++ /tmp/payhome.site.conf	2019-08-07 17:12:04.041905944 +0800
@@ -1,61 +1,7 @@
 server {
         listen      80;
         server_name www.payhome.site;
-        index   index.jsp index.html index.htm;
-        charset utf-8;
-        access_log  logs/pms2-80.access.log main;
-        access_log  logs/pms2-80.logstash.access.log logstash;
-        location ~ ^/(WEB-INF)/ {
-            deny all;
-        }
-  
-        location / {
-		   include /usr/local/nginx/conf.d/global/whitelist_map2.conf;
-           proxy_redirect          off; 
-				proxy_set_header        Host            $host; 
-				proxy_set_header        X-Real-IP       $remote_addr;
-				proxy_set_header        referer         "";
-				proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for; 
-    	proxy_cache cache_after;
-        proxy_cache_key    $uri$is_args$args;
-        add_header X-Cache $upstream_cache_status;
-        proxy_cache_valid 200 10m;
-        proxy_cache_valid 301 302 5m;
-        proxy_cache_valid any 1m;
-        proxy_cache_use_stale error http_500 http_502 http_503 http_504;
-				proxy_connect_timeout   80; 
-				proxy_send_timeout      80; 
-				proxy_read_timeout      80; 
-				client_max_body_size    35m;
-				client_body_buffer_size 256k;
-				proxy_buffer_size       256k;
-				proxy_buffers           4 256k;
-				proxy_busy_buffers_size 256k;
-				proxy_temp_file_write_size      256k;
-            proxy_pass http://pms2_web;
-        }
-
-        #location ~* .*\.(png|jpg|gif|jpeg|bmp|ico)?$ {
-        #        proxy_next_upstream http_502 http_504 error timeout invalid_header;
-        #        proxy_cache cache_after;
-        #        proxy_cache_valid  200 206 304 301 302 12h;
-        #        proxy_cache_valid any 1m;
-        #        proxy_cache_key $uri$is_args$args;
-        #        proxy_set_header Host  $host;
-        #        proxy_set_header X-Forwarded-For  $remote_addr;
-       #         proxy_pass http://pms2_web;
-       # }
-
-      #  location ~* .*\.(css|js|json)?$ {
-       #         proxy_next_upstream http_502 http_504 error timeout invalid_header;
-      #          proxy_cache cache_after;
-       #         proxy_cache_valid  200 304 2m;
-       #         proxy_cache_valid any 30s;
-       #         proxy_cache_key $uri$is_args$args;
-       #         proxy_set_header Host  $host;
-       #         proxy_set_header X-Forwarded-For  $remote_addr;
-       #        proxy_pass http://pms2_web;
-       # }
+  		rewrite ^(.*)$ https://www.payhome.site$1 permanent;
 }
 
 
@@ -65,9 +11,9 @@
         index   index.jsp index.html index.htm;
         charset utf-8;
   
-  	ssl on;
-    ssl_certificate /usr/local/nginx/conf.d/ssl/payhome.site/fullchain.pem;
-    ssl_certificate_key /usr/local/nginx/conf.d/ssl/payhome.site/privkey.pem;
+  		ssl on;
+    	ssl_certificate /usr/local/nginx/conf.d/ssl/payhome.site/fullchain.pem;
+    	ssl_certificate_key /usr/local/nginx/conf.d/ssl/payhome.site/privkey.pem;
   
         access_log  logs/pms2-80.access.log main;
         access_log  logs/pms2-80.logstash.access.log logstash;
@@ -76,8 +22,8 @@
         }
   
         location / {
-		   include /usr/local/nginx/conf.d/global/whitelist_map2.conf;
-           proxy_redirect          off; 
+		   		include /usr/local/nginx/conf.d/global/whitelist_map2.conf;
+           		proxy_redirect          off; 
 				proxy_set_header        Host            $host; 
 				proxy_set_header        X-Real-IP       $remote_addr;
 				proxy_set_header        referer         "";
@@ -98,7 +44,7 @@
 				proxy_buffers           4 256k;
 				proxy_busy_buffers_size 256k;
 				proxy_temp_file_write_size      256k;
-            proxy_pass http://pms2_web;
+            	proxy_pass http://pms2_web;
         }
 }
 

