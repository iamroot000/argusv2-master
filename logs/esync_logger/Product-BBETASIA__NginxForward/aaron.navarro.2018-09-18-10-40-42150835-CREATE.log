--- /srv/Product-BBETASIA__NginxForward/nginx/conf.d/include/bbetasia_official_masterconfig.include	2018-08-29 13:48:34.430330464 +0800
+++ /tmp/bbetasia_official_masterconfig.include	2018-09-18 10:40:42.019701565 +0800
@@ -1,110 +1,90 @@
-        proxy_intercept_errors  on;
-        error_page      404     /404.jsp;
-        error_page      500     /500.jsp;
+index   index.jsp index.html index.htm;
+access_log  logs/bbetasia.access.log main;
+access_log  logs/bbetasia.logstash.access.log logstash;
 
-        index   index.jsp index.html index.htm;
-        access_log  logs/bbetasia.access.log main;
-        access_log  logs/bbetasia.logstash.access.log logstash;
+if ($http_user_agent ~* "qihu|360|360se|360ee|QIHU 360SE|(iPhone|iPad|iPod|Linux|android|Android|bb\d+|meego).+mobile|Android|MobileSafari|iPhone|iPad|iPod|Linux|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android 3.0") {
+set $mobile_rewrite perform;
+}
 
-        if ($http_user_agent ~* "qihu|360|360se|360ee|QIHU 360SE|(iPhone|iPad|iPod|Linux|android|Android|bb\d+|meego).+mobile|Android|MobileSafari|iPhone|iPad|iPod|Linux|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android 3.0") {
-        set $mobile_rewrite perform;
-           }
+if ( $mobile_rewrite = perform )
+{ set $upstream mobile_bbetasia; }
 
+if ($http_user_agent ~* "(X11)")
+{ set $mobile_rewrite per;  }
 
-        if ( $mobile_rewrite = perform )
-        { set $upstream mobile_bbetasia; }
+if ( $mobile_rewrite != perform )
+{ set $upstream desktop_bbetasia; }
 
-        if ($http_user_agent ~* "(X11)")
-        { set $mobile_rewrite per;  }
+if ($host ~* pc\.(.*))
+{ set $upstream desktop_bbetasia; }
 
-        if ( $mobile_rewrite != perform )
-        { set $upstream desktop_bbetasia; }
+if ($http_user_agent ~* "qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot")
+{
+return 403;
+}
 
-        if ($host ~* pc\.(.*))
-        { set $upstream desktop_bbetasia; }
+limit_req zone=anti_spider burst=5 nodelay;
+if ($http_user_agent ~* "baiduspider") {
+set $anti_spider $http_user_agent;
+}
 
-        if ($http_user_agent ~* "qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot")
-        {
-                return 403;
-        }
+if ($request_method !~* GET|POST|HEAD) {
+return 403;
+}
 
+location ~ /\.
+{ return 444; }
 
-        limit_req zone=anti_spider burst=5 nodelay;
-        if ($http_user_agent ~* "baiduspider") {
-                set $anti_spider $http_user_agent;
-        }
+error_page 403 = @403;
+	location @403 {
+	root html;
+	allow all;
+	rewrite ^(.*)$ /red-map.jpg break;
+}
+
+location  ~/loginCpmsOpus.do {
+	if ($host ~ "opusgm888.com|opusgm888.net"){
+		access_log  logs/bbetasia_opuslogin.access.log main;
+		access_log  logs/bbetasia_opuslogin.logstash.access.log logstash;
+		proxy_pass http://clientgamecalled;
+	}
+}
 
-        if ($request_method !~* GET|POST|HEAD) {
-                return 403;
-        }
+if ($allowed_country ~ "no" )
+{ set $test BLOCK; }
 
-        location ~ /\.
-        { return 444; }
+if ($allowed_country ~ "yes" ) 
+{ set $test ALLOW; }
 
-	error_page 403 = @403;
-	location @403 {
-		root html;
-		allow all;
-		rewrite ^(.*)$ /red-map.jpg break;
-	}
+if ($allowed_ip ~ "yes" ){ 
+set $test ALLOW; 
+}
 
-        location  ~/loginCpmsOpus.do {
-        		if ($host ~ "opusgm888.com|opusgm888.net"){
-        			access_log  logs/bbetasia_opuslogin.access.log main;
-	  				access_log  logs/bbetasia_opuslogin.logstash.access.log logstash;
-	                proxy_pass http://clientgamecalled;
-        		}
-      
-                
-        }
-
-
-	location / {
-	    if ($allowed_country ~ "no" )
-		{ set $test BLOCK; }
-
-	    if ($allowed_country ~ "yes" ) 
-		{ set $test ALLOW; }
-
-	    if ( $remote_addr ~  '203.83.41.10|114.215.70.125|118.99.30.86|60.246.115.111|45.114.9.59|210.1.83.162|103.39.111.169|203.177.15.222|103.29.22.114|175.100.203.210|119.9.107.189|103.29.22.115|118.99.30.86|45.114.9.59|103.29.22.117|210.213.229.239|222.127.98.10|103.246.245.137|103.29.22.115|119.93.239.175|146.88.67.154|202.78.110.218|122.52.163.197|210.213.229.198|119.92.91.7|60.172.141.214|180.232.127.178|203.82.36.42|119.93.239.175|122.53.145.230|103.16.170.130|124.107.15.140|122.53.159.158|103.16.170.194|123.192.164.89|202.146.217.25|210.83.80.139|120.28.15.34|103.231.56.86|120.28.15.49|103.230.192.119|203.69.30.90|115.84.245.30|119.47.85.245|115.126.21.27|118.99.17.143|1.1.1.1|106.1.44.204|120.28.15.25|180.232.67.64|180.232.67.27|180.232.67.94|218.189.28.0/28|111.68.46.85|103.29.22.117|203.177.15.98|103.230.193.172|43.240.12.236|222.127.40.146|175.45.41.114|175.45.41.115|119.81.56.201|203.177.134.146|103.29.22.118|43.231.229.122|203.177.14.50|210.56.50.111|103.51.147.70|210.213.221.110|59.188.254.126|223.119.51.107|223.119.51.106|103.16.170.194|103.16.170.195|103.16.170.196|203.69.30.85|203.69.30.86|203.69.30.87|203.69.30.88|203.69.30.89|175.100.203.98|175.100.203.99|175.100.205.50|175.100.205.51|203.90.246.98|203.90.246.99|203.90.248.98|203.90.248.99|203.90.255.250|203.90.255.251|222.127.145.18|222.127.2.210|203.177.9.198|175.45.41.126|175.45.41.125|175.100.203.99|175.100.203.100|175.100.203.101|175.100.203.102|175.100.205.51|175.100.205.52|175.100.205.53|175.100.205.54|203.90.246.99|203.90.246.100|203.90.246.101|203.90.246.102|203.90.248.99|203.90.248.100|203.90.248.101|203.90.248.102|203.90.255.251|203.90.255.252|203.90.255.253|203.90.255.254|203.177.34.98|175.100.203.106|43.231.229.123|203.82.41.10|103.39.108.64|103.39.110.127|103.195.51.126|118.99.60.168|175.100.203.211|116.50.155.210|175.45.41.122|223.119.50.66|222.127.1.66|210.68.209.240|210.68.209.241|210.68.209.242|210.68.209.243|210.68.209.244|210.68.209.245|210.68.209.246|210.68.209.247|211.24.96.55|223.119.49.66|203.90.246.82|146.88.66.164|223.119.193.42|223.119.193.43' )
-		{ set $test ALLOW; }
-
-	    if ( $test = "BLOCK" ) { return 403;  }
-            proxy_set_header Host  $host;
-            proxy_set_header X-Forwarded-For  $remote_addr;
-            proxy_pass http://$upstream;
-
-        }
+location / {
+	if ( $test = "BLOCK" ) { 
+		return 403;  
+	}
+	proxy_set_header Host  $host;
+	proxy_set_header X-Forwarded-For  $remote_addr;
+	proxy_pass http://$upstream;
+
+}
 
 
 
-        location /websocket {
-            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
-            proxy_set_header X-Real-IP  $remote_addr;
-            proxy_next_upstream http_502 http_504 http_404 error timeout invalid_header;
-            proxy_set_header Host $host:$server_port;
-            proxy_http_version 1.1;
-            proxy_set_header Upgrade $http_upgrade;
-            proxy_set_header Connection $connection_upgrade;
-            proxy_connect_timeout   1800;
-            proxy_send_timeout      1800;
-            proxy_read_timeout      1800;
-  		
-            proxy_pass http://9280;
-        }
-
-
-        location /version.txt {
-            proxy_pass http://$upstream;
-            allow 203.192.151.8/29; #pacnet-gdc
-            allow 203.177.198.112/29; #globe-gdc
-            allow 101.78.133.208/28; #wtt-hkidc
-            allow 205.177.199.0/28; #pccw-hkidc
-            allow 203.177.15.220/30; #globe-tz
-            allow 103.29.22.112/29; #fccdci-tz
-            allow 175.45.41.112/28; #wtt
-            deny  all;
-       }
+location /websocket {
+	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
+	proxy_set_header X-Real-IP  $remote_addr;
+	proxy_next_upstream http_502 http_504 http_404 error timeout invalid_header;
+	proxy_set_header Host $host:$server_port;
+	proxy_http_version 1.1;
+	proxy_set_header Upgrade $http_upgrade;
+	proxy_set_header Connection $connection_upgrade;
+	proxy_connect_timeout   1800;
+	proxy_send_timeout      1800;
+	proxy_read_timeout      1800;
+	proxy_pass http://9280;
+}
 
 
 

