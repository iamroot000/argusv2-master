upstream 9299 {
	server 205.177.199.6:9299  max_fails=2  fail_timeout=30s weight=5 backup;
	server 101.78.133.216:9299 max_fails=2  fail_timeout=30s weight=5 backup;
    server 205.177.199.9:9299  max_fails=2  fail_timeout=30s weight=5;
	server 101.78.133.221:9299 max_fails=2  fail_timeout=30s weight=5 backup;
    server 58.64.207.210:9299  max_fails=2  fail_timeout=30s weight=5;
	server 59.148.22.110:9299  max_fails=2  fail_timeout=30s weight=5;
}


server {
    listen 80;
    server_name v68fpms1.appcoffee.cn;
    include /usr/local/nginx/conf.d/include/v68_fpms.include;
}

index   index.jsp index.html index.htm;
access_log  logs/app.access.log main;
access_log  logs/app.logstash.access.log logstash;

set $allowed_country yes;
set $allowed_ip  yes;

if ($allowed_country ~ "no" ){
       set $test BLOCK;
}

if ($allowed_country ~ "yes" ){
       set $test ALLOW;
}

if ($allowed_ip ~ "yes" ){
       set $test ALLOW;
}


location /websocket {
  if ( $test = "BLOCK" ) { return 666;  }
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Real-IP  $remote_addr;
	proxy_next_upstream http_502 http_504 http_404 error timeout invalid_header;
	proxy_set_header Host $host:$server_port;
	proxy_http_version 1.1;
	proxy_set_header Upgrade $http_upgrade;
	proxy_set_header Connection $connection_upgrade;
	proxy_connect_timeout   1800;
	proxy_send_timeout      1800;
	proxy_read_timeout      1800;
	proxy_pass http://9288;
}


