--- /ansible/nginx/hostgroups/bbet8-nginx/nginx/conf.d/include/xdl_proxy_official_masterconfig.include	2019-09-13 15:02:44.593009621 +0800
+++ /tmp/xdl_proxy_official_masterconfig.include	2019-09-13 15:07:40.903292067 +0800
@@ -1,6 +1,6 @@
-        proxy_intercept_errors  on;
-        error_page      404     /404.jsp;
-        error_page      500     /500.jsp;
+#        proxy_intercept_errors  on;
+#        error_page      404     /404.jsp;
+#        error_page      500     /500.jsp;
 
         index   index.jsp index.html index.htm;
         access_log  logs/xjw_xyh.access.log main;
@@ -26,7 +26,7 @@
 	return 403;
 }
 
-        limit_req zone=anti_spider burst=5 nodelay;
+#        limit_req zone=anti_spider burst=5 nodelay;
         if ($http_user_agent ~* "baiduspider") {
                 set $anti_spider $http_user_agent;
         }
@@ -47,19 +47,19 @@
 
 	location / {
         
-        try_files $uri $uri/ /index.html;
+#        try_files $uri $uri/ /index.html;
   
-	    if ($allowed_country ~ "no" )
-		{ set $test BLOCK; }
+#	    if ($allowed_country ~ "no" )
+#		{ set $test BLOCK; }
 
-	    if ($allowed_country ~ "yes" ) 
-		{ set $test ALLOW; }
+#	    if ($allowed_country ~ "yes" ) 
+#		{ set $test ALLOW; }
 
-        if ($allowed_ip ~ "yes" ){ 
-        set $test ALLOW; 
-        }
+#        if ($allowed_ip ~ "yes" ){ 
+#        set $test ALLOW; 
+#        }
 
-	    if ( $test = "BLOCK" ) { return 403;  }
+#	    if ( $test = "BLOCK" ) { return 403;  }
             proxy_set_header Host  $host;
             proxy_set_header X-Forwarded-For  $remote_addr;
             proxy_set_header X-Forwarded-Proto $scheme ;
@@ -84,20 +84,32 @@
         }
 
 
-
-        location /version.txt {
-            proxy_pass http://$upstream;
-            allow 203.192.151.8/29; #pacnet-gdc
-            allow 203.177.198.112/29; #globe-gdc
-            allow 101.78.133.208/28; #wtt-hkidc
-            allow 205.177.199.0/28; #pccw-hkidc
-            allow 203.177.15.220/30; #globe-tz
-            allow 103.29.22.112/29; #fccdci-tz
-            allow 175.45.41.112/28; #wtt
-            deny  all;
+	location ~* .*\.(png|jpg|gif|jpeg|bmp|ico|css|js|json|exe)?$ {
+            proxy_next_upstream http_502 http_504 error timeout invalid_header;
+            #proxy_cache cache_after;
+            #proxy_cache_valid  200 304 12h;
+	         #proxy_cache_key $host$uri$query_string;
+            proxy_set_header Host  $host;
+            proxy_set_header X-Forwarded-For  $remote_addr;
+            proxy_set_header X-Forwarded-Proto $scheme ;
+	         proxy_pass http://$upstream;
+            #expires      2h;
        }
 
 
+#        location /version.txt {
+#            proxy_pass http://$upstream;
+#            allow 203.192.151.8/29; #pacnet-gdc
+#            allow 203.177.198.112/29; #globe-gdc
+#            allow 101.78.133.208/28; #wtt-hkidc
+#            allow 205.177.199.0/28; #pccw-hkidc
+#            allow 203.177.15.220/30; #globe-tz
+#            allow 103.29.22.112/29; #fccdci-tz
+#            allow 175.45.41.112/28; #wtt
+ #           deny  all;
+ #      }
+
+
 
 
 

